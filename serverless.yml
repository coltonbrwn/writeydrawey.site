# Welcome to Serverless!
#
# This file is the main config file for your service.
# It's very minimal at this point and uses default values.
# You can always add more config options for more control.
# We've included some commented out config examples here.
# Just uncomment any of them to get that config option.
#
# For full config options, check the docs:
#    docs.serverless.com
#
# Happy Coding!

name: writey-drawey-site

myNextApp:
  component: serverless-next.js
  inputs:
    domain: ["writeydrawey.site"]

gameApi:
  component: "@serverless/aws-lambda"
  inputs:
    name: writey-drawey-api
    description: "general purpose endpoint for game management"
    memory: 128
    timeout: 20
    code: ./backend
    handler: index.submit
    runtime: nodejs12.x
    region: us-east-1

gameState:
  component: "@serverless/aws-lambda"
  inputs:
    name: writey-drawey-game-state
    description: "polling endpoint for game state"
    memory: 1024
    timeout: 4
    code: ./backend
    handler: index.get
    runtime: nodejs12.x
    region: us-east-1

cors:
  component: "@serverless/aws-lambda"
  inputs:
    name: writey-drawey-api-cors
    description: "general purpose CORS endpoint"
    memory: 128
    timeout: 20
    code: ./backend
    handler: index.cors
    runtime: nodejs12.x
    region: us-east-1

api:
  component: "@serverless/aws-api-gateway"
  inputs:
    description: Writey Drawey
    cors: true
    endpoints:
      - path: /api
        method: POST
        function: ${gameApi.arn}
      - path: /api
        method: OPTIONS
        function: ${cors.arn}
      - path: /state
        method: GET
        function: ${gameState.arn}

gamesTable:
  component: '@serverless/aws-dynamodb'
  inputs:
    name: writey-drawey-games # optional
    attributeDefinitions:
      - AttributeName: id
        AttributeType: S
    keySchema:
      - AttributeName: id
        KeyType: HASH
    region: us-east-1

playersTable:
  component: '@serverless/aws-dynamodb'
  inputs:
    name: writey-drawey-players # optional
    attributeDefinitions:
      - AttributeName: id
        AttributeType: S
      - AttributeName: gameId
        AttributeType: S
    keySchema:
      - AttributeName: id
        KeyType: HASH
    globalSecondaryIndexes:
      - IndexName: 'gameIndex'
        KeySchema:
         - AttributeName: gameId
           KeyType: HASH
        Projection:
           ProjectionType: 'KEYS_ONLY'
    region: us-east-1
